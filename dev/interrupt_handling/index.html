<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Handling SIGINT · NATS</title><meta name="title" content="Handling SIGINT · NATS"/><meta property="og:title" content="Handling SIGINT · NATS"/><meta property="twitter:title" content="Handling SIGINT · NATS"/><meta name="description" content="Documentation for NATS."/><meta property="og:description" content="Documentation for NATS."/><meta property="twitter:description" content="Documentation for NATS."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">NATS</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">NATS.jl - NATS client for Julia.</a></li><li><a class="tocitem" href="../examples/">Quick examples</a></li><li><a class="tocitem" href="../benchmarks/">Benchmarks</a></li><li><span class="tocitem">Functions</span><ul><li><a class="tocitem" href="../connect/">Connect</a></li><li><a class="tocitem" href="../pubsub/">Publish - subscribe</a></li><li><a class="tocitem" href="../reqreply/">Request - reply</a></li></ul></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../design/">Design notes</a></li><li><a class="tocitem" href="../protocol/">Protocol messages</a></li><li class="is-active"><a class="tocitem" href>Handling SIGINT</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internals</a></li><li class="is-active"><a href>Handling SIGINT</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Handling SIGINT</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jakubwro/NATS.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jakubwro/NATS.jl/blob/main/docs/src/interrupt_handling.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Handling-SIGINT"><a class="docs-heading-anchor" href="#Handling-SIGINT">Handling SIGINT</a><a id="Handling-SIGINT-1"></a><a class="docs-heading-anchor-permalink" href="#Handling-SIGINT" title="Permalink"></a></h1><p>When SIGINT is delivered, for instance when pressing <code>CTRL+C</code> in interactive session or externally by container runtime (for instance Kubernetes pod autoscaller) it is hard to ensure proper action is executed.</p><p>Julia tasks might be scheduled on two threadpools, <code>:interactive</code> and <code>:default</code> and sizes of those threadpools are configured by <code>--threads</code> option. First one is intended to run short interactive tasks (like network communication), second one is for more CPU intensive operations that might block a thread for longer time.</p><p>When <code>SIGINT</code> is delivered it is delivered only to the first thread and which threadpool it handles depends on <code>--threads</code> configuration.</p><p>For instance:</p><ul><li><code>--threads 1</code> runs 0 <code>:interactive</code> threads and 1 <code>:default</code> threads.</li><li><code>--threads 1,1</code> runs 1 <code>:interactive</code> threads and 1 <code>:default</code> threads.</li><li><code>--threads 2,3</code> runs 3 <code>:interactive</code> threads and 2 <code>:default</code> threads.</li></ul><p>To ensure <code>drain</code> in <code>NATS</code> action is executed on interrupt signal <code>julia</code> should be run with exactly one <code>:interactive</code> thread. Otherwise some cpu intensive tasks may be scheduled on the first thread, or in case when there are more than one interactive threads, handler might be scheduled on different thread and miss interrupt signal.</p><p>To ensure signal is delivered to the tasks that knows how to handle it, all <code>:interactive</code> tasks are wrapped into <code>disable_sigint</code> method except the one that have proper logic for connection draining.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../protocol/">« Protocol messages</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.0 on <span class="colophon-date" title="Thursday 30 November 2023 21:07">Thursday 30 November 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
